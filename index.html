<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>HAR to JSON Converter</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto,
          sans-serif;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        min-height: 100vh;
        display: flex;
        justify-content: center;
        align-items: center;
        padding: 20px;
      }

      .container {
        background: white;
        border-radius: 20px;
        box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
        padding: 40px;
        max-width: 600px;
        width: 100%;
      }

      h1 {
        color: #333;
        margin-bottom: 10px;
        text-align: center;
      }

      .subtitle {
        color: #666;
        text-align: center;
        margin-bottom: 30px;
        font-size: 14px;
      }

      .drop-zone {
        border: 3px dashed #cbd5e0;
        border-radius: 15px;
        padding: 60px 20px;
        text-align: center;
        cursor: pointer;
        transition: all 0.3s ease;
        background: #f7fafc;
      }

      .drop-zone:hover {
        border-color: #667eea;
        background: #edf2f7;
      }

      .drop-zone.dragging {
        border-color: #667eea;
        background: #e9d8fd;
        transform: scale(1.02);
      }

      .drop-zone svg {
        width: 60px;
        height: 60px;
        margin-bottom: 20px;
        fill: #a0aec0;
      }

      .drop-zone p {
        color: #718096;
        font-size: 16px;
        margin-bottom: 10px;
      }

      .drop-zone span {
        color: #a0aec0;
        font-size: 14px;
      }

      .file-input {
        display: none;
      }

      .results {
        margin-top: 30px;
        display: none;
      }

      .results.show {
        display: block;
      }

      .stats {
        background: #f7fafc;
        border-radius: 10px;
        padding: 20px;
        margin-bottom: 20px;
      }

      .stat-row {
        display: flex;
        justify-content: space-between;
        margin-bottom: 10px;
      }

      .stat-row:last-child {
        margin-bottom: 0;
      }

      .stat-label {
        color: #718096;
        font-size: 14px;
      }

      .stat-value {
        color: #2d3748;
        font-weight: 600;
        font-size: 14px;
      }

      .filter-section {
        margin-bottom: 20px;
      }

      .filter-label {
        display: block;
        margin-bottom: 10px;
        color: #4a5568;
        font-size: 14px;
        font-weight: 500;
      }

      .filter-options {
        display: flex;
        gap: 15px;
        flex-wrap: wrap;
      }

      .filter-option {
        display: flex;
        align-items: center;
        gap: 5px;
      }

      .filter-option input {
        cursor: pointer;
      }

      .filter-option label {
        cursor: pointer;
        font-size: 14px;
        color: #4a5568;
      }

      .buttons {
        display: flex;
        gap: 10px;
        margin-top: 20px;
      }

      .btn {
        flex: 1;
        padding: 12px 16px;
        border: none;
        border-radius: 8px;
        font-size: 14px;
        font-weight: 500;
        cursor: pointer;
        transition: all 0.3s ease;
      }

      .btn-primary {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
      }

      .btn-primary:hover {
        transform: translateY(-2px);
        box-shadow: 0 10px 20px rgba(102, 126, 234, 0.4);
      }

      .btn-secondary {
        background: #e2e8f0;
        color: #4a5568;
      }

      .btn-secondary:hover {
        background: #cbd5e0;
      }

      .preview {
        background: #2d3748;
        border-radius: 10px;
        padding: 20px;
        margin-top: 20px;
        max-height: 300px;
        overflow-y: auto;
      }

      .preview pre {
        color: #e2e8f0;
        font-family: 'Courier New', monospace;
        font-size: 12px;
        line-height: 1.5;
        margin: 0;
      }

      .url-filter {
        width: 100%;
        padding: 8px 12px;
        border: 1px solid #cbd5e0;
        border-radius: 6px;
        font-size: 14px;
        margin-bottom: 10px;
      }

      .url-filter:focus {
        outline: none;
        border-color: #667eea;
        box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
      }

      .footer {
        text-align: center;
        margin-top: 40px;
        padding-top: 20px;
        border-top: 1px solid #e2e8f0;
      }

      .footer a {
        color: #718096;
        text-decoration: none;
        font-size: 14px;
        transition: color 0.3s ease;
      }

      .footer a:hover {
        color: #667eea;
      }

      .toast {
        position: fixed;
        top: 20px;
        right: 20px;
        background: #48bb78;
        color: white;
        padding: 12px 20px;
        border-radius: 8px;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        font-size: 14px;
        font-weight: 500;
        z-index: 1000;
        transform: translateX(100%);
        opacity: 0;
        transition: all 0.3s ease;
      }

      .toast.show {
        transform: translateX(0);
        opacity: 1;
      }

      .toast.error {
        background: #f56565;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <h1>ðŸ”„ HAR to JSON Converter</h1>
      <p class="subtitle">Convert Chrome DevTools HAR files to JSON format</p>

      <div class="drop-zone" id="dropZone">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
          <path
            d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"
            stroke-width="2"
            stroke-linecap="round"
            stroke-linejoin="round"
          />
        </svg>
        <p>Drop HAR file here</p>
        <span>or click to select file</span>
        <input type="file" class="file-input" id="fileInput" accept=".har" />
      </div>

      <div class="results" id="results">
        <div class="stats">
          <div class="stat-row">
            <span class="stat-label">File Name:</span>
            <span class="stat-value" id="fileName">-</span>
          </div>
          <div class="stat-row">
            <span class="stat-label">Total Requests:</span>
            <span class="stat-value" id="totalRequests">-</span>
          </div>
          <div class="stat-row">
            <span class="stat-label">JSON Responses:</span>
            <span class="stat-value" id="jsonResponses">-</span>
          </div>
          <div class="stat-row">
            <span class="stat-label">Export Count:</span>
            <span class="stat-value" id="exportCount">-</span>
          </div>
        </div>

        <div class="filter-section">
          <label class="filter-label">URL Filter (supports regex):</label>
          <input
            type="text"
            class="url-filter"
            id="urlFilter"
            placeholder="e.g. /api/.* or example.com"
          />

          <label class="filter-label" style="margin-top: 15px"
            >Response Status Code Filter:</label
          >
          <div class="filter-options">
            <div class="filter-option">
              <input type="checkbox" id="status200" checked />
              <label for="status200">200 OK</label>
            </div>
            <div class="filter-option">
              <input type="checkbox" id="status201" checked />
              <label for="status201">201 Created</label>
            </div>
            <div class="filter-option">
              <input type="checkbox" id="status4xx" />
              <label for="status4xx">4xx Errors</label>
            </div>
            <div class="filter-option">
              <input type="checkbox" id="status5xx" />
              <label for="status5xx">5xx Errors</label>
            </div>
          </div>
        </div>

        <div class="buttons">
          <button class="btn btn-secondary" onclick="resetAll()">
            Select Again
          </button>
          <button class="btn btn-secondary" onclick="copyToClipboard()">
            Copy JSON
          </button>
          <button class="btn btn-primary" onclick="exportJsonl()">
            Export JSON
          </button>
        </div>

        <div class="preview">
          <pre id="previewContent">Loading...</pre>
        </div>
      </div>

      <div class="footer">
        <a href="https://rxliuli.com" target="_blank" rel="noopener noreferrer">
          More tools at rxliuli.com
        </a>
      </div>
    </div>

    <script>
      let harData = null
      let jsonEntries = []

      const dropZone = document.getElementById('dropZone')
      const fileInput = document.getElementById('fileInput')
      const results = document.getElementById('results')

      // Drag and drop events
      dropZone.addEventListener('click', () => fileInput.click())

      dropZone.addEventListener('dragover', (e) => {
        e.preventDefault()
        dropZone.classList.add('dragging')
      })

      dropZone.addEventListener('dragleave', () => {
        dropZone.classList.remove('dragging')
      })

      dropZone.addEventListener('drop', (e) => {
        e.preventDefault()
        dropZone.classList.remove('dragging')

        const files = e.dataTransfer.files
        if (files.length > 0) {
          handleFile(files[0])
        }
      })

      fileInput.addEventListener('change', (e) => {
        if (e.target.files.length > 0) {
          handleFile(e.target.files[0])
        }
      })

      // Event listeners for URL filter and status code filter
      document
        .getElementById('urlFilter')
        .addEventListener('input', updatePreview)
      document.querySelectorAll('.filter-option input').forEach((checkbox) => {
        checkbox.addEventListener('change', updatePreview)
      })

      // Toast notification function
      function showToast(message, type = 'success') {
        const toast = document.createElement('div')
        toast.className = `toast ${type === 'error' ? 'error' : ''}`
        toast.textContent = message
        document.body.appendChild(toast)
        
        setTimeout(() => toast.classList.add('show'), 100)
        setTimeout(() => {
          toast.classList.remove('show')
          setTimeout(() => document.body.removeChild(toast), 300)
        }, 3000)
      }

      function handleFile(file) {
        if (!file.name.endsWith('.har')) {
          showToast('Please select a HAR file!', 'error')
          return
        }

        const reader = new FileReader()
        reader.onload = (e) => {
          try {
            harData = JSON.parse(e.target.result)
            processHar(file.name)
          } catch (error) {
            showToast('Failed to parse HAR file!', 'error')
            console.error(error)
          }
        }
        reader.readAsText(file)
      }

      function processHar(fileName) {
        jsonEntries = []

        harData.log.entries.forEach((entry) => {
          const contentType = entry.response.content.mimeType || ''

          // Check if it's a JSON response
          if (
            contentType.includes('json') ||
            contentType.includes('javascript')
          ) {
            try {
              let responseData

              // Handle base64 encoded content
              if (entry.response.content.encoding === 'base64') {
                const decoded = atob(entry.response.content.text)
                responseData = JSON.parse(decoded)
              } else {
                responseData = JSON.parse(entry.response.content.text || '{}')
              }

              jsonEntries.push({
                url: entry.request.url,
                method: entry.request.method,
                status: entry.response.status,
                timestamp: entry.startedDateTime,
                data: responseData,
              })
            } catch (e) {
              // Skip if parsing fails
              console.warn('Failed to parse JSON for:', entry.request.url)
            }
          }
        })

        // Update statistics
        document.getElementById('fileName').textContent = fileName
        document.getElementById('totalRequests').textContent =
          harData.log.entries.length
        document.getElementById('jsonResponses').textContent =
          jsonEntries.length

        // Show results area
        results.classList.add('show')
        dropZone.style.display = 'none'

        updatePreview()
      }

      function getFilteredEntries() {
        let filtered = [...jsonEntries]

        // URL filtering
        const urlFilter = document.getElementById('urlFilter').value.trim()
        if (urlFilter) {
          try {
            const regex = new RegExp(urlFilter, 'i')
            filtered = filtered.filter((entry) => regex.test(entry.url))
          } catch (e) {
            // If not valid regex, treat as plain string match
            filtered = filtered.filter((entry) =>
              entry.url.toLowerCase().includes(urlFilter.toLowerCase()),
            )
          }
        }

        // Status code filtering
        const status200 = document.getElementById('status200').checked
        const status201 = document.getElementById('status201').checked
        const status4xx = document.getElementById('status4xx').checked
        const status5xx = document.getElementById('status5xx').checked

        filtered = filtered.filter((entry) => {
          const status = entry.status
          if (status200 && status === 200) return true
          if (status201 && status === 201) return true
          if (status4xx && status >= 400 && status < 500) return true
          if (status5xx && status >= 500 && status < 600) return true
          return false
        })

        return filtered
      }

      function updatePreview() {
        const filtered = getFilteredEntries()

        // Update export count
        document.getElementById('exportCount').textContent = filtered.length

        // Generate preview (show first 3 entries at most)
        const preview = filtered.slice(0, 3)

        let previewText = `// Preview of first ${Math.min(
          3,
          filtered.length,
        )} entries (${filtered.length} total)\n// Note: Only response data will be exported to JSON\n\n`
        preview.forEach((entry, index) => {
          previewText += `// [${index + 1}] ${entry.url} (Status: ${entry.status})\n`
          previewText += JSON.stringify(entry.data) + '\n'
          if (index < preview.length - 1) previewText += '\n'
        })

        if (filtered.length === 0) {
          previewText = '// No matching data'
        }

        document.getElementById('previewContent').textContent = previewText
      }

      function exportJsonl() {
        const filtered = getFilteredEntries()

        if (filtered.length === 0) {
          showToast('No data to export!', 'error')
          return
        }

        // Generate JSON format (array of response objects)
        const jsonContent = JSON.stringify(
          filtered.map((entry) => entry.data),
          null,
          2
        )

        // Download file
        const blob = new Blob([jsonContent], {
          type: 'application/json',
        })
        const url = URL.createObjectURL(blob)
        const a = document.createElement('a')
        a.href = url
        a.download = `har_export_${new Date().getTime()}.json`
        document.body.appendChild(a)
        a.click()
        document.body.removeChild(a)
        URL.revokeObjectURL(url)

        // Show success message
        showToast(`Successfully exported ${filtered.length} entries!`)
      }

      async function copyToClipboard() {
        const filtered = getFilteredEntries()

        if (filtered.length === 0) {
          showToast('No data to copy!', 'error')
          return
        }

        // Generate JSON format (same as export)
        const jsonContent = JSON.stringify(
          filtered.map((entry) => entry.data),
          null,
          2
        )

        try {
          await navigator.clipboard.writeText(jsonContent)
          showToast(`Successfully copied ${filtered.length} entries to clipboard!`)
        } catch (err) {
          // Fallback for older browsers
          const textArea = document.createElement('textarea')
          textArea.value = jsonContent
          textArea.style.position = 'fixed'
          textArea.style.left = '-999999px'
          textArea.style.top = '-999999px'
          document.body.appendChild(textArea)
          textArea.focus()
          textArea.select()
          
          try {
            document.execCommand('copy')
            showToast(`Successfully copied ${filtered.length} entries to clipboard!`)
          } catch (err) {
            showToast('Failed to copy to clipboard!', 'error')
          }
          
          document.body.removeChild(textArea)
        }
      }

      function resetAll() {
        harData = null
        jsonEntries = []
        results.classList.remove('show')
        dropZone.style.display = 'block'
        fileInput.value = ''
        document.getElementById('urlFilter').value = ''
        document.getElementById('status200').checked = true
        document.getElementById('status201').checked = true
        document.getElementById('status4xx').checked = false
        document.getElementById('status5xx').checked = false
      }
    </script>
  </body>
</html>
